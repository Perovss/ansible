auto lo
iface lo inet loopback
    dns-nameservers {% for dns in ansible_dns.nameservers if dns !='127.0.0.53' %}{{dns}} {% endfor%}

auto {{ansible_default_ipv4.interface}}
iface {{ansible_default_ipv4.interface}} inet static
    address {{ansible_default_ipv4.address}}
    netmask {{ansible_default_ipv4.netmask}}
    gateway {{ansible_default_ipv4.gateway}}
    mtu 1500
{% for local_interface in local_interfaces %} 
auto {{local_interface.device}}
iface {{local_interface.device}} inet static
address {{local_interface.ipv4.address}} 
netmask {{local_interface.ipv4.netmask}}
mtu 1500
{% endfor %}
{% if static_routes is defined and static_routes | length  %}
{% for static_route in static_routes %} 
up route add -net {{static_route.network }} gw {{ static_route.gateway}}
{% endfor %}
{% endif %}

{% for local_interface in local_interfaces %} 
auto {{local_interface.device }}.{{ vlan_id}}
iface {{local_interface.device }}.{{ vlan_id}} inet manual
{%- endfor %}

{% if bridge_interfaces is not defined %}
auto {{br_interface}}
iface {{br_interface}} inet static
    address {{bridge_ip | ipaddr('address')}}
    netmask {{bridge_ip | ipaddr('netmask')}}
{% for local_interface in local_interfaces %} 
    bridge_ports {{local_interface.device }}.{{ vlan_id}}    
{% endfor %}
    bridge_fd 0
{% else %}
{% for bridge_interface in bridge_interfaces %} 
auto {{bridge_interface.device}}
iface {{bridge_interface.device}} inet static
    address {{bridge_interface.ipv4.address}}
    netmask {{bridge_interface.ipv4.netmask}} 
{% for local_interface in local_interfaces %} 
    bridge_ports {{local_interface.device }}.{{ vlan_id}}
{% endfor %}
    bridge_fd 0
{% endfor %}
{% endif %}